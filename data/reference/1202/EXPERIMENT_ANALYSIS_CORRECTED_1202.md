# 実験結果の考察と今後の方向性（修正版）

## 📊 正確なデータに基づく分析結果

### 各シナリオでの比較表

#### 冬季閑散期テスト（2024/1/28-2/3、1,517件/日）

| モデル | 重症系RT | vs直近隊 | 6分重症% | vs直近隊 |
|--------|----------|----------|----------|----------|
| 冬季閑散期モデル | 8.03 | +0.11 | 30.8 | -0.8 |
| 春季閑散期モデル | 8.41 | +0.49 | 28.6 | -3.0 |
| 夏季繁忙期モデル | 8.28 | +0.36 | 29.8 | -1.8 |
| 冬季繁忙期モデル | 8.45 | +0.53 | 31.0 | -0.6 |
| **直近隊運用** | **7.92** | - | **31.6** | - |
| 傷病度考慮運用 | 7.80 | -0.12 | 34.8 | +3.2 |

#### 春季閑散期テスト（2024/4/7-4/13、1,464件/日）

| モデル | 重症系RT | vs直近隊 | 6分重症% | vs直近隊 |
|--------|----------|----------|----------|----------|
| 春季閑散期モデル | 7.43 | +0.35 | 35.6 | -2.3 |
| 冬季閑散期モデル | 7.33 | +0.25 | 37.2 | -0.7 |
| 夏季繁忙期モデル | 7.33 | +0.25 | 34.0 | -3.9 |
| 冬季繁忙期モデル | 7.25 | +0.17 | 37.4 | -0.5 |
| **直近隊運用** | **7.08** | - | **37.9** | - |
| 傷病度考慮運用 | 6.80 | -0.28 | 42.2 | +4.3 |

#### 夏季繁忙期テスト（2024/7/14-20、1,772件/日）

| モデル | 重症系RT | vs直近隊 | 6分重症% | vs直近隊 |
|--------|----------|----------|----------|----------|
| 夏季繁忙期モデル | 10.64 | +0.83 | 20.7 | -11.0 |
| 冬季閑散期モデル | 10.26 | +0.45 | 21.5 | -10.2 |
| 春季閑散期モデル | 10.75 | +0.94 | 21.5 | -10.2 |
| 冬季繁忙期モデル | 10.73 | +0.92 | 20.7 | -11.0 |
| **直近隊運用** | **9.81** | - | **31.7** | - |
| 傷病度考慮運用 | 9.77 | -0.04 | 26.2 | -5.5 |

#### 冬季繁忙期テスト（2024/12/8-12/14、1,624件/日）

| モデル | 重症系RT | vs直近隊 | 6分重症% | vs直近隊 |
|--------|----------|----------|----------|----------|
| 冬季繁忙期モデル | 8.97 | +0.67 | 27.7 | -2.0 |
| 冬季閑散期モデル | 8.83 | +0.53 | 28.5 | -1.2 |
| 春季閑散期モデル | 9.26 | +0.96 | 26.8 | -2.9 |
| 夏季繁忙期モデル | 9.12 | +0.82 | 27.3 | -2.4 |
| **直近隊運用** | **8.30** | - | **29.7** | - |
| 傷病度考慮運用 | 8.47 | +0.17 | 29.5 | -0.2 |

---

## 🔍 結果から推察される内容

### 発見1: PPOは全シナリオで直近隊に完敗

```
全4シナリオ × 4PPOモデル = 16ケース

重症系RTで直近隊を上回ったPPO: 0/16（0%）
6分達成率で直近隊を上回ったPPO: 0/16（0%）
```

**推察:**
- ハイブリッドPPOの現在の設計では、直近隊を上回ることができていない
- 軽症系でカバレッジを考慮する戦略が、全体の性能を悪化させている
- PPOが学習している「何か」が、直近隊のシンプルな最寄り選択より劣っている

### 発見2: 当該シナリオモデルが必ずしも最良ではない

```
冬季閑散期テスト → 最良PPOは「冬季閑散期モデル」（RT）/ 「冬季繁忙期モデル」（6分）
春季閑散期テスト → 最良PPOは「冬季繁忙期モデル」（RT・6分両方）
夏季繁忙期テスト → 最良PPOは「冬季閑散期モデル」（RT・6分両方）
冬季繁忙期テスト → 最良PPOは「冬季閑散期モデル」（RT・6分両方）
```

**推察:**
1. **冬季閑散期モデルの汎用性**
   - 繁忙期テスト（夏季・冬季）で最良
   - 重症率が高い冬季で学習 → 重症系への対応力が高い

2. **冬季繁忙期モデルの閑散期での強さ**
   - 春季閑散期で最良
   - 繁忙期で「リソース逼迫下での慎重な配車」を学習
   - これが閑散期でも安定した性能につながる

3. **当該シナリオへの過学習**
   - 夏季繁忙期モデルは夏季繁忙期で最良ではない
   - 春季閑散期モデルは春季閑散期で最良ではない
   - 学習データの特定パターンに過適合している可能性

### 発見3: 直近隊運用の件数・季節依存性

```
シナリオ        件数/日    全体RT    重症系RT    軽症系RT    6分重症%
春季閑散期      1,464      6.96      7.08       6.96       37.9  ← 最良
冬季閑散期      1,517      8.04      7.92       8.06       31.6
冬季繁忙期      1,624      8.47      8.30       8.50       29.7
夏季繁忙期      1,772      9.91      9.81       9.93       31.7  ← 最悪
```

**推察:**
1. **件数増加に伴うRT悪化は明確**
   - 春季(1,464件) → 夏季(1,772件)で、重症系RTは7.08分 → 9.81分（+2.73分）

2. **冬季閑散期の特異性**
   - 件数は春季より多い(+53件)のに、RTは悪化(+0.84分)
   - 季節要因（寒波、路面状況など）の影響が示唆される

3. **6分達成率の非線形性**
   - 件数が増えても6分達成率は31.6〜31.7%で安定（冬季閑散期、夏季繁忙期）
   - 春季閑散期の37.9%が突出して高い

### 発見4: 傷病度考慮運用の効果は閑散期で顕著

```
シナリオ        重症系RT差    6分重症%差    評価
冬季閑散期        -0.12        +3.2      ★★★ 優位
春季閑散期        -0.28        +4.3      ★★★ 優位
夏季繁忙期        -0.04        -5.5      ★ RTのみやや優位
冬季繁忙期        +0.17        -0.2      × 劣位
```

**推察:**
1. **閑散期では傷病度考慮が有効**
   - 冬季閑散期: RT -0.12分、6分達成率 +3.2%
   - 春季閑散期: RT -0.28分、6分達成率 +4.3%
   - カバレッジを考慮する余裕があり、効果を発揮

2. **繁忙期では傷病度考慮が機能しない**
   - 夏季繁忙期: 6分達成率 -5.5%（直近隊より大幅悪化）
   - 冬季繁忙期: ほぼ同等（カバレッジ考慮の効果なし）
   - リソース逼迫時は最寄り選択が最適

3. **PPOに示唆されること**
   - 閑散期と繁忙期で異なる戦略が必要
   - 固定の重み付けでは両方に対応できない

### 発見5: PPOの弱点は「軽症系の配車」

```
全シナリオで:
  PPOの軽症系RT > 直近隊の軽症系RT

例（冬季閑散期）:
  直近隊: 軽症系RT 8.06分
  冬季閑散期モデル: 軽症系RT 11.60分（+3.54分）

例（夏季繁忙期）:
  直近隊: 軽症系RT 9.93分
  夏季繁忙期モデル: 軽症系RT 13.06分（+3.13分）
```

**推察:**
- PPOは軽症系でカバレッジを考慮 → 遠くの救急車を選択
- これにより軽症系RTが大幅悪化（+3分以上）
- 軽症系が多いため、全体の効率が低下
- 結果として重症系対応のリソースも逼迫

---

## 🎯 今後の方向性

### 方向性A: 軽症系の候補を限定する（最優先・短期）

**根拠:**
- PPOの明確な弱点は軽症系の配車
- 軽症系で直近隊と同じ行動を取れば、少なくとも負けない

**具体策:**
```
現状: 軽症系でカバレッジ損失を考慮して候補を選択
変更: 軽症系も最寄り3〜5台のみを候補に限定

期待効果:
  - 軽症系RT: 直近隊と同等に（-3分程度改善）
  - 重症系: ハイブリッドPPOの効果を維持
  - 最低でも直近隊と同等の性能を保証
```

### 方向性B: 冬季閑散期モデルをベースに改良（短期）

**根拠:**
- 繁忙期テストで一貫して最良のPPO
- 重症率が高い冬季で学習 → 重症系対応力が高い

**具体策:**
```
1. 冬季閑散期モデルのハイパーパラメータを維持
2. 学習期間を2週間に延長
3. 重症系の報酬重みをさらに強化
```

### 方向性C: 傷病度考慮運用のロジックをPPOに組み込む（中期）

**根拠:**
- 傷病度考慮運用は閑散期で直近隊を上回る
- PPOがこのロジックを学習できれば、閑散期で勝てる可能性

**具体策:**
```
1. 傷病度考慮運用と同じスコア計算をPPOの報酬に反映
2. ただし、稼働率に応じて重みを動的に変更
   - 低稼働率: time×0.6 + coverage×0.4
   - 高稼働率: time×0.9 + coverage×0.1
```

### 方向性D: 閑散期に特化して「勝てるモデル」を作る（短期・推奨）

**根拠:**
- 傷病度考慮運用が閑散期で直近隊を上回っている
- PPOがこれを模倣できれば、閑散期で勝てる
- まず「勝てる」経験を得ることが重要

**具体策:**
```
ターゲット: 春季閑散期（傷病度考慮が最も効果的）

1. 春季閑散期のデータのみで学習
2. 傷病度考慮運用の報酬設計を模倣
3. 直近隊より良い結果を目指す

成功基準:
  - 重症系RT: 直近隊(7.08分)以下
  - 6分達成率: 直近隊(37.9%)以上
```

### 方向性E: 重症系のみに特化する（中期）

**根拠:**
- 軽症系でカバレッジを考慮することが悪影響
- 重症系のみに介入し、軽症系は直近隊と同じにする

**具体策:**
```
重症系: PPOが救急車を選択（ハイブリッドPPOの恩恵）
軽症系: 常に最寄りを選択（直近隊と同じ）

期待効果:
  - 軽症系: 直近隊と同等
  - 重症系: PPOの改善効果のみ残る
```

---

## 📋 推奨する実験の優先順位

### 優先度1（今週）: 軽症系の候補を最寄り3台に限定

```yaml
変更内容:
  軽症系の候補選択: 全救急車 → 最寄り3台のみ
  
期待効果:
  軽症系RT: -3分程度改善（直近隊と同等に）
  
テスト:
  全4シナリオで評価
  成功基準: 直近隊との差が縮小
```

### 優先度2（今週〜来週）: 春季閑散期に特化したモデル

```yaml
設定:
  Training: 2023/3/26-4/15
  Validation: 2023/4/16-4/22
  Test: 2024/4/7-4/13
  
報酬設計:
  傷病度考慮運用を模倣（time×0.6 + coverage×0.4）
  
成功基準:
  重症系RT < 7.08分（直近隊）
  6分達成率 > 37.9%（直近隊）
```

### 優先度3（来週以降）: 冬季閑散期モデルの改良

```yaml
設定:
  Training: 2023/1/15-2/4（現行）+ 期間延長
  重症系報酬: 1.5倍に強化
  
テスト:
  繁忙期シナリオ（夏季・冬季）
  
成功基準:
  繁忙期での直近隊との差を縮小
```

---

## 💡 最も勝てる可能性が高いシナリオ

### 第1候補: 春季閑散期

```
根拠:
  - 傷病度考慮運用が最も効果的（直近隊より RT -0.28分、6分達成率 +4.3%）
  - PPOがこのロジックを学習できれば勝てる可能性が高い
  - 件数が最も少なく、カバレッジ考慮の余地が大きい

アプローチ:
  - 傷病度考慮運用の報酬設計を模倣
  - 軽症系の候補を限定して悪影響を防ぐ
```

### 第2候補: 冬季閑散期

```
根拠:
  - 傷病度考慮運用が直近隊より優位（RT -0.12分、6分達成率 +3.2%）
  - 冬季閑散期モデルが当該シナリオで最良のPPO

アプローチ:
  - 冬季閑散期モデルの改良
  - 傷病度考慮のロジック組み込み
```

---

## 📝 結論

### 現状のまとめ

1. **PPOは全16ケースで直近隊に完敗**
   - 重症系RT: 全て直近隊より悪い（+0.11〜+0.96分）
   - 6分達成率: 全て直近隊より悪い（-0.5〜-11.0%）

2. **当該シナリオモデルが最良ではないケースが多い**
   - 冬季閑散期モデルが繁忙期で最良
   - 冬季繁忙期モデルが春季閑散期で最良
   - 過学習または学習データの特性による

3. **傷病度考慮運用は閑散期で有効**
   - 春季閑散期: RT -0.28分、6分達成率 +4.3%
   - 冬季閑散期: RT -0.12分、6分達成率 +3.2%
   - 繁忙期では効果なし〜悪化

4. **PPOの弱点は軽症系の配車**
   - 軽症系RTが直近隊より+3分以上悪い
   - カバレッジ考慮が裏目に出ている

### 推奨する次のステップ

```
1. 軽症系の候補を最寄り3台に限定（今週）
   → PPOの明確な弱点を対処
   → 最低でも直近隊と同等を保証

2. 春季閑散期に特化したモデルを作成（今週〜来週）
   → 傷病度考慮が有効なシナリオで勝ちを狙う
   → まず「勝てる」経験を得る

3. 成功したら他のシナリオへ展開（来週以降）
```
